Apacheの設定についての課題

本番環境については、
\\192.168.1.101\グループ共有\14.システム\Shunichi_Baba\
ここにサーバーアクセス情報があります。



↓各課題の設定事項

▼vhosts

[/etc/httpd/conf.d/test.conf]
・VirtualHostを80番ポートで2つ設定しました
・それぞれにドキュメントルートとドメイン名を設定しました


▼環境変数

（ローカル環境）
[/etc/httpd/conf.d/test.conf]
・/var/www/html/testというディレクトリへ環境変数TEST_ENVへLOCALという値を設定しました

[/var/www/html/test.php]
TEST_ENVの値を取得し、LOCALであれば「ローカル環境です」、PRODUCTIONであれば「本番環境です」と表示される

（本番環境）
[/etc/httpd/conf.d/test.conf]
・/var/www/html/testというディレクトリへ環境変数TEST_ENVへPRODUCTIONという値を設定しました

[/var/www/html/test.php]
TEST_ENVの値を取得し、LOCALであれば「ローカル環境です」、PRODUCTIONであれば「本番環境です」と表示される（ローカルと同じ内容です）


▼mod_rewrite(htacccess)

[/var/www/html/.htaccess]
・RewriteRuleを2つ追記しました。
・mod_writeが実行されるように、RewriteEngine Onも記載しました


▼アドレスとポートのバインド

[/etc/httpd/conf.d/test.conf]
・Listen 8080と追記しました。
・ファイヤーウォールの設定で、8080ポートも開放しました


▼BASIC認証/アクセス制限

[/etc/httpd/htpasswd]
・htpasswdコマンドを使用し、ユーザー名とパスワードの設定をしました

[/etc/httpd/conf.d/test.conf]
・/var/www/html/adminというディレクトリへBasic認証させる分を追記
・/var/www/html/adminというディレクトリへ社内IPのみからアクセスできるように追記


▼ログファイル
[/etc/httpd/conf.d/test.conf]
・log_config_moduleへLogformatとCustomLogの追記をしました
・%tはリスエストされた時刻
・/var/log/httpd/test/のパーミッションへ書き込みのみを有効にした



↓設定ファイルのコード


[/etc/httpd/conf.d/test.conf]

<VirtualHost *:80>
  DocumentRoot /var/www/vhosts/test1
  ServerName one.example.com
</VirtualHost>

<VirtualHost *:80>
  DocumentRoot /var/www/vhosts/test2
  ServerName second.example.com
</VirtualHost>

<VirtualHost *:80>
  DocumentRoot /var/www/html
  ServerName example.local

  <Directory "var/www/html/admin">
    AuthType Basic
    AuthName "auth"
    AuthUserFile /etc/httpd/htpasswd
    Require valid-user
  </Directory>

  <Directory "var/www/html/admin">
    Require ip 122.217.37.50
  </Directory>

  <Directory "/var/www/html/test">
    SetEnv TEST_ENV LOCAL
  </Directory>

</VirtualHost>

<IfModule dir_module>
    DirectoryIndex test1.html test2.html
</IfModule>

<IfModule log_config_module>
    LogFormat "%t" test
    CustomLog "logs/test/test_log" test
</IfModule>

Listen 8080


[/var/www/html/.htaccess]

RewriteEngine On

RewriteRule ^index.php$ http://example.local/ [L,R=301]

RewriteRule ^123/$ /index.php/?q=123 [L,R=301]
[vagrant@vagrant html]$ sudo vi /etc/httpd/conf.d/test.conf
[vagrant@vagrant html]$ sudo cat .htaccess
RewriteEngine On

RewriteRule ^index.php$ http://example.local/ [L,R=301]

RewriteRule ^123/$ /index.php/?q=123 [L,R=301]


[/etc/httpd/htpasswd]
si-baba:$apr1$4f4hJy5m$3mrYRpizegbNUj6Eil5/Z.